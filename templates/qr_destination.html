<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check In - {{ qr_code.name }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/qr_destination.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <meta name="robots" content="noindex, nofollow">
    <style>
        /* Additional styles for location tracking */
        .location-status {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 12px 16px;
            margin: 15px 0;
            font-size: 14px;
            display: none;
            align-items: center;
            gap: 8px;
        }
        
        .location-status.loading {
            background: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }
        
        .location-status.success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        
        .location-status.error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        
        .location-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            display: none;
            font-size: 13px;
        }
        
        .location-info h4 {
            margin: 0 0 10px 0;
            font-size: 14px;
            color: #495057;
        }
        
        .coord-row {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .coord-row:last-child {
            border-bottom: none;
        }
        
        .coord-value {
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }
        
        .location-controls {
            text-align: center;
            margin: 10px 0;
        }
        
        .btn-small {
            background: #6c757d;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin: 0 4px;
            transition: background-color 0.2s;
        }
        
        .btn-small:hover {
            background: #545b62;
        }

        /* Language Selector Styles */
        .language-selector {
            position: absolute;
            top: 1rem;
            right: 1rem;
            z-index: 1000;
        }

        .language-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50px;
            padding: 0.5rem 1rem;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            backdrop-filter: blur(10px);
            font-size: 0.875rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            outline: none;
        }

        .language-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-1px);
        }

        .language-toggle:active {
            background: rgba(255, 255, 255, 0.4);
            transform: translateY(0);
        }

        .language-toggle:focus {
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.3);
        }

        .language-toggle i {
            font-size: 1rem;
        }

        /* Smooth transitions */
        .fade-transition {
            transition: opacity 0.15s ease;
        }

        .fade-transition.active {
            opacity: 1;
        }

        /* Mobile responsive adjustments */
        @media (max-width: 768px) {
            .language-selector {
                position: relative;
                top: 0;
                right: 0;
                text-align: center;
                margin-bottom: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="destination-container">
        <!-- Language Selector -->
        <div class="language-selector">
            <button id="languageToggle" class="language-toggle" type="button" aria-label="Switch Language">
                <i class="fas fa-globe"></i>
                <span id="languageText">EN</span>
            </button>
        </div>

        <!-- Header Section - WITH TRANSLATIONS -->
        <div class="destination-header fade-transition active">
            <div class="header-icon">
                <i class="fas fa-qrcode"></i>
            </div>
            <h1>{{ qr_code.location_event }}</h1>
            <p class="location-info">
                <i class="fas fa-map-marker-alt"></i>
                {{ qr_code.location }}
            </p>
        </div>

        <!-- Check-in Form - WITH TRANSLATIONS -->
        <div class="checkin-card fade-transition active">
            <div class="checkin-header">
                <h2>
                    <i class="fas fa-user-check"></i>
                    <span data-en="Attendance Tracking" data-es="Seguimiento de asistencia">Attendance Tracking</span>
                </h2>
                <p data-en="Please enter your Employee ID to check in" data-es="Por favor ingrese su ID de Empleado para registrarse">Please enter your Employee ID to check in</p>
            </div>

            <form id="checkinForm" class="checkin-form">
                <!-- HIDDEN LOCATION FIELDS -->
                <input type="hidden" id="latitude" name="latitude">
                <input type="hidden" id="longitude" name="longitude">
                <input type="hidden" id="accuracy" name="accuracy">
                <input type="hidden" id="altitude" name="altitude">
                <input type="hidden" id="locationSource" name="location_source" value="manual">
                <input type="hidden" id="address" name="address">

                <div class="form-group">
                    <label for="employee_id">
                        <i class="fas fa-id-badge"></i>
                        <span data-en="Employee ID" data-es="ID de Empleado">Employee ID</span>
                    </label>
                    <input type="text" 
                           id="employee_id" 
                           name="employee_id" 
                           required 
                           data-placeholder-en="Enter your Employee ID"
                           data-placeholder-es="Ingrese su ID de Empleado"
                           placeholder="Enter your Employee ID"
                           autocomplete="off"
                           maxlength="20">
                    <small class="form-help" 
                           data-en="Use your official employee ID (3-20 characters)" 
                           data-es="Use su ID oficial de empleado (3-20 caracteres)">
                        Use your official employee ID (3-20 characters)
                    </small>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <span class="btn-content">
                            <i class="fas fa-check"></i>
                            <span data-en="Submit" data-es="Someter">Submit</span>
                        </span>
                        <div class="btn-loader" style="display: none;">
                            <i class="fas fa-spinner fa-spin"></i>
                            <span data-en="Processing..." data-es="Procesando...">Processing...</span>
                        </div>
                    </button>
                </div>
            </form>

            <!-- Status Messages -->
            <div id="statusMessage" class="status-message" style="display: none;">
                <!-- Dynamic status messages will appear here -->
            </div>
        </div>

        <!-- Success Card (Hidden by default) - WITH TRANSLATIONS -->
        <div id="successCard" class="success-card fade-transition" style="display: none;">
            <div class="success-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <h2 data-en="Submitted Successful!" data-es="Enviado exitosamente!">Submitted Successful!</h2>
            <div class="success-details">
                <div class="success-item">
                    <strong data-en="Employee ID:" data-es="ID de Empleado:">Employee ID:</strong>
                    <span id="successEmployeeId">-</span>
                </div>
                <div class="success-item">
                    <strong data-en="Location/Building:" data-es="Ubicación/Edificio:">Location/Building:</strong>
                    <span id="successLocation">-</span>
                </div>
                <div class="success-item">
                    <strong data-en="Event:" data-es="Evento:">Event:</strong>
                    <span id="successEvent">-</span>
                </div>
                <div class="success-item">
                    <strong data-en="Time:" data-es="Hora:">Time:</strong>
                    <span id="successTime">-</span>
                </div>
                <div class="success-item">
                    <strong data-en="Date:" data-es="Fecha:">Date:</strong>
                    <span id="successDate">-</span>
                </div>
                <!-- LOCATION SUCCESS INFO -->
                <div class="success-item" id="successLocationInfo" style="display: none;">
                    <strong data-en="GPS Location:" data-es="Ubicación GPS:">GPS Location:</strong>
                    <span id="successGpsInfo">-</span>
                </div>
            </div>
            
            <div class="success-actions">
                <button onclick="checkInAnother()" class="btn btn-secondary">
                    <i class="fas fa-plus"></i>
                    <span data-en="Check In Another Employee" data-es="Registrar Otro Empleado">Check In Another Employee</span>
                </button>
            </div>
        </div>

        <!-- Footer - WITH TRANSLATIONS -->
        <div class="destination-footer fade-transition active">
            <p>
                <i class="fas fa-shield-alt"></i>
                <span data-en="Secure attendance tracking system" data-es="Sistema seguro de seguimiento de asistencia">Secure attendance tracking system</span>
            </p>
            <small data-en="© 2025 QR Management System" data-es="© 2025 Sistema de Gestión QR">© 2025 QR Management System</small>
        </div>
    </div>

    <!-- Loading Overlay - WITH TRANSLATIONS -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p data-en="Processing check-in..." data-es="Procesando registro...">Processing check-in...</p>
        </div>
    </div>

    <!-- Load the JavaScript -->
    <script src="{{ url_for('static', filename='js/qr_destination.js') }}"></script>
    <script>
        // Initialize page with QR code URL
        window.qrUrl = '{{ qr_code.qr_url }}';
        window.locationName = '{{ qr_code.location }}';
        window.eventName = '{{ qr_code.location_event }}';
    </script>
</body>
</html>